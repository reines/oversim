<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OverSim: MyOverlay Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<h1>MyOverlay Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="MyOverlay" --><!-- doxytag: inherits="BaseOverlay" -->
<p><code>#include &lt;<a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for MyOverlay:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classMyOverlay.png" usemap="#MyOverlay_map" alt=""/>
  <map id="MyOverlay_map" name="MyOverlay_map">
<area href="classBaseOverlay.html" alt="BaseOverlay" shape="rect" coords="115,112,220,136"/>
<area href="classBaseRpc.html" alt="BaseRpc" shape="rect" coords="0,56,105,80"/>
<area href="classBaseTcpSupport.html" alt="BaseTcpSupport" shape="rect" coords="115,56,220,80"/>
<area href="classTopologyVis.html" alt="TopologyVis" shape="rect" coords="230,56,335,80"/>
<area href="classRpcListener.html" alt="RpcListener" shape="rect" coords="0,0,105,24"/>
</map>
</div>

<p><a href="classMyOverlay-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a963b6240e2e917a70c329b2153d19734">MyOverlay</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a6bfa6db09589828cd6e6dcf81c778d81">~MyOverlay</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a9fa3f3705a1825911d534892d6846237">handleTimerEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a651f1dbe4f6371f3a58dff39ad457d48">initializeOverlay</a> (int stage)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes derived-class-attributes.  <a href="#a651f1dbe4f6371f3a58dff39ad457d48"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a9d5aadf1daaa6e02cf3c785811278b0c">setOwnNodeID</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Overlay implementations can overwrite this virtual method to set a specific nodeID.  <a href="#a9d5aadf1daaa6e02cf3c785811278b0c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a98f93274ec15fefc1bd3fa24af43b35c">joinOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Join the overlay with a given nodeID in thisNode.key.  <a href="#a98f93274ec15fefc1bd3fa24af43b35c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a2c99f0d95f68f8135dac6acc3a24011b">finishOverlay</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">collects statistical data in derived class  <a href="#a2c99f0d95f68f8135dac6acc3a24011b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBaseKeySortedVector.html">NodeVector</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a9bcbf789e463e45f5d8c2028e8568ca7">findNode</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, int numRedundantNodes, int numSiblings, <a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *msg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implements the find node call.  <a href="#a9bcbf789e463e45f5d8c2028e8568ca7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a1a588f5af9c3aee2484d9d0e8ed89b44">isSiblingFor</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;node, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;key, int numSiblings, bool *err)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Query if a node is among the siblings for a given key.  <a href="#a1a588f5af9c3aee2484d9d0e8ed89b44"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a4afcf38dab3c871471fc658c7a12ee4c">getMaxNumSiblings</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay protocol.  <a href="#a4afcf38dab3c871471fc658c7a12ee4c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a6e8306f62ca6378f317d401b378af724">getMaxNumRedundantNodes</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Query the maximum number of redundant next hop nodes that are returned by <a class="el" href="classMyOverlay.html#a9bcbf789e463e45f5d8c2028e8568ca7" title="Implements the find node call.">findNode()</a>.  <a href="#a6e8306f62ca6378f317d401b378af724"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#ac42f8d1581e303ac02eb3d165c54df72">getNeighbors</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;neighborKey)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a55d11f3488949255da4a147bbd86b83e">callbackNeighbors</a> (const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;neighborKey, const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;prevNeighbor, const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;nextNeighbor)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#ab5282917369412abe224bbf606482284">callbackTimeout</a> (const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;neighborKey)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#af4b0a674e6403aff467c6d94a03fce95">handleRpcCall</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a1ce676207ea25678af8eacc5d2b52902">handleRpcResponse</a> (<a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *msg, cPolymorphic *context, int rpcId, simtime_t rtt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#ad0bd399bae0aa1631314d8904efe4038">handleRpcTimeout</a> (<a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *msg, const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;dest, cPolymorphic *context, int rpcId, const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNodeHandle.html">NodeHandle</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classNodeHandle.html">NodeHandle</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#a50231da7a7af9554661dafb98eb3ad61">dropChance</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMyOverlay.html#ac900d0d8bd93f7b17a6519d5ae1d8bc6">numDropped</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">number of dropped packets  <a href="#ac900d0d8bd93f7b17a6519d5ae1d8bc6"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<dl class="author"><dt><b>Author:</b></dt><dd>Antonio Zea </dd></dl>

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00028">28</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a963b6240e2e917a70c329b2153d19734"></a><!-- doxytag: member="MyOverlay::MyOverlay" ref="a963b6240e2e917a70c329b2153d19734" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MyOverlay::MyOverlay </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00095">95</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p><div class="fragment"><pre class="fragment">{ <a class="code" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a> = NULL; };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6bfa6db09589828cd6e6dcf81c778d81"></a><!-- doxytag: member="MyOverlay::~MyOverlay" ref="a6bfa6db09589828cd6e6dcf81c778d81" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MyOverlay::~MyOverlay </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00096">96</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p><div class="fragment"><pre class="fragment">{ cancelAndDelete(<a class="code" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a>); };
</pre></div></p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a55d11f3488949255da4a147bbd86b83e"></a><!-- doxytag: member="MyOverlay::callbackNeighbors" ref="a55d11f3488949255da4a147bbd86b83e" args="(const NodeHandle &amp;neighborKey, const NodeHandle &amp;prevNeighbor, const NodeHandle &amp;nextNeighbor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::callbackNeighbors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>neighborKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>prevNeighbor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>nextNeighbor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00278">278</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00255">handleRpcResponse()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &lt;&lt; <span class="stringliteral">&quot;: (RPC) Got response from &quot;</span>
       &lt;&lt; neighborKey &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
       &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &lt;&lt; <span class="stringliteral">&quot;: (RPC) Neighbors: &quot;</span>
       &lt;&lt; prevNeighbor.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
       &lt;&lt; nextNeighbor.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>() &lt;&lt; std::endl;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab5282917369412abe224bbf606482284"></a><!-- doxytag: member="MyOverlay::callbackTimeout" ref="ab5282917369412abe224bbf606482284" args="(const OverlayKey &amp;neighborKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::callbackTimeout </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>neighborKey</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00289">289</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00233">handleRpcTimeout()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    EV &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &lt;&lt; <span class="stringliteral">&quot;: (RPC) Query to &quot;</span> &lt;&lt; neighborKey
       &lt;&lt; <span class="stringliteral">&quot; timed out!&quot;</span> &lt;&lt; std::endl;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9bcbf789e463e45f5d8c2028e8568ca7"></a><!-- doxytag: member="MyOverlay::findNode" ref="a9bcbf789e463e45f5d8c2028e8568ca7" args="(const OverlayKey &amp;key, int numRedundantNodes, int numSiblings, BaseOverlayMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBaseKeySortedVector.html">NodeVector</a> * MyOverlay::findNode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numRedundantNodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numSiblings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classBaseOverlayMessage.html">BaseOverlayMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements the find node call. </p>
<p>This method simply returns the closest nodes known in the corresponding routing topology. If the node is a sibling for this key (isSiblingFor(key) = true), this method returns all numSiblings siblings, with the closest neighbor to the key first.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>key</em>&nbsp;</td><td>The lookup key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>numRedundantNodes</em>&nbsp;</td><td>Maximum number of next hop nodes to return. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>numSiblings</em>&nbsp;</td><td>number of siblings to return </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>msg</em>&nbsp;</td><td>A pointer to the <a class="el" href="classBaseRouteMessage.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">BaseRouteMessage</a> or <a class="el" href="classFindNodeCall.html" title="Class generated from common/CommonMessages.msg by opp_msgc.">FindNodeCall</a> message of this lookup. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NodeVector with closest nodes. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a7cbdce336237331b67a3c69c4e43d489">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00121">121</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classBaseKeySortedVector.html">NodeVector</a>* nextHops;

    <span class="comment">// do we drop the packet?</span>
    <span class="keywordflow">if</span> (uniform(0, 1) &lt; <a class="code" href="classMyOverlay.html#a50231da7a7af9554661dafb98eb3ad61">dropChance</a>) {
        <span class="comment">// if yes, return an empty node vector</span>
        nextHops = <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a>(0);
        <a class="code" href="classMyOverlay.html#ac900d0d8bd93f7b17a6519d5ae1d8bc6" title="number of dropped packets">numDropped</a>++;
        <span class="keywordflow">return</span> nextHops;
    }

    <span class="comment">// else, set the response vector with one node</span>
    nextHops = <span class="keyword">new</span> <a class="code" href="NodeVector_8h.html#a442f90b66b22aa9fca51f83c5ce1b02b">NodeVector</a>(1);

    <span class="comment">// are we responsible? next step is this node</span>
    <span class="keywordflow">if</span> (key == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()) {
        nextHops-&gt;<a class="code" href="classBaseKeySortedVector.html#a3fdb759e6bb3232ec8ce9d572637429e" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
    }
    <span class="comment">// is the key behind us? next step is the previous node</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key &lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()) {
        nextHops-&gt;<a class="code" href="classBaseKeySortedVector.html#a3fdb759e6bb3232ec8ce9d572637429e" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a>);
    }
    <span class="comment">// otherwise, the next step is the next node</span>
    <span class="keywordflow">else</span> {
        nextHops-&gt;<a class="code" href="classBaseKeySortedVector.html#a3fdb759e6bb3232ec8ce9d572637429e" title="adds an element of type T in increasing order to the NodeVector and returns the position of the added...">add</a>(<a class="code" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a>);
    }
    <span class="keywordflow">return</span> nextHops;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2c99f0d95f68f8135dac6acc3a24011b"></a><!-- doxytag: member="MyOverlay::finishOverlay" ref="a2c99f0d95f68f8135dac6acc3a24011b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::finishOverlay </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collects statistical data in derived class </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a8db85b9c706d04007154761d5a0cec16">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00155">155</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// remove this node from the overlay</span>
    <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">false</span>);

    <span class="comment">// save the statistics (see BaseApp)</span>
    <a class="code" href="classBaseRpc.html#a9552ba3a2b09c83b3c561e65dab9f23d" title="pointer to GlobalStatistics module in this node">globalStatistics</a>-&gt;<a class="code" href="classGlobalStatistics.html#a6a697a0b67f344e4bc214159761f943a" title="Add a new value to the cStdDev container specified by the name parameter.">addStdDev</a>(<span class="stringliteral">&quot;MyOverlay: Dropped packets&quot;</span>, <a class="code" href="classMyOverlay.html#ac900d0d8bd93f7b17a6519d5ae1d8bc6" title="number of dropped packets">numDropped</a>);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e8306f62ca6378f317d401b378af724"></a><!-- doxytag: member="MyOverlay::getMaxNumRedundantNodes" ref="a6e8306f62ca6378f317d401b378af724" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MyOverlay::getMaxNumRedundantNodes </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the maximum number of redundant next hop nodes that are returned by <a class="el" href="classMyOverlay.html#a9bcbf789e463e45f5d8c2028e8568ca7" title="Implements the find node call.">findNode()</a>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of redundant nodes returned by <a class="el" href="classMyOverlay.html#a9bcbf789e463e45f5d8c2028e8568ca7" title="Implements the find node call.">findNode()</a>. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#ab4dadd02486560de3a58773b3a90fb41">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00171">171</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> 1;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4afcf38dab3c871471fc658c7a12ee4c"></a><!-- doxytag: member="MyOverlay::getMaxNumSiblings" ref="a4afcf38dab3c871471fc658c7a12ee4c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int MyOverlay::getMaxNumSiblings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the maximum number of siblings (nodes close to a key) that are maintained by this overlay protocol. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of siblings. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#acd3058ad15b470e024500dd4872e2f09">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00165">165</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> 1;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac42f8d1581e303ac02eb3d165c54df72"></a><!-- doxytag: member="MyOverlay::getNeighbors" ref="ac42f8d1581e303ac02eb3d165c54df72" args="(const OverlayKey &amp;neighborKey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::getNeighbors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>neighborKey</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00177">177</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00086">handleTimerEvent()</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <a class="code" href="classMyNeighborCall.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborCall</a> *msg = <span class="keyword">new</span> <a class="code" href="classMyNeighborCall.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborCall</a>();
    msg-&gt;<a class="code" href="classMyNeighborCall.html#a230b2a33215198daba2fe2850907f25b">setDestinationKey</a>(neighborKey);

    <span class="comment">// The function we&#39;ll be using to send an RPC is sendRouteRpcCall.</span>
    <span class="comment">// The first value is to which tier we&#39;ll be talking. Can be either</span>
    <span class="comment">// OVERLAY_COMP, TIER1_COMP, TIER2_COMP, and so on.</span>
    <span class="comment">// The second parameter is the node to which we&#39;ll send the message.</span>
    <span class="comment">// Can be either an OverlayKey or a TransportAddress.</span>
    <span class="comment">// The third parameter is the message.</span>

    EV &lt;&lt; <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &lt;&lt; <span class="stringliteral">&quot;: (RPC) Sending query to &quot;</span>
       &lt;&lt; neighborKey &lt;&lt; <span class="stringliteral">&quot;!&quot;</span> &lt;&lt; std::endl;

    <a class="code" href="classBaseRpc.html#a816918e82652f724c291923e018eabe2" title="Routes a Remote-Procedure-Call message to an OverlayKey.">sendRouteRpcCall</a>(<a class="code" href="CommonMessages__m_8h.html#aad57ef0110fe8675eb299d467148bc5ead1b904580b02f8adaa1ab2de239c4c79">OVERLAY_COMP</a>, neighborKey, msg);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="af4b0a674e6403aff467c6d94a03fce95"></a><!-- doxytag: member="MyOverlay::handleRpcCall" ref="af4b0a674e6403aff467c6d94a03fce95" args="(BaseCallMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MyOverlay::handleRpcCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00197">197</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// There are many macros to simplify the handling of RPCs. The full list is in &lt;OverSim&gt;/src/common/RpcMacros.h.</span>

    <span class="comment">// start a switch</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg);

    <span class="comment">// enters the following block if the message is of type MyNeighborCall (note the shortened parameter!)</span>
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(MyNeighbor) {
        <span class="comment">// get Call message</span>
        <a class="code" href="classMyNeighborCall.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborCall</a> *mrpc = (<a class="code" href="classMyNeighborCall.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborCall</a>*)msg;

        <span class="comment">// create response</span>
        <a class="code" href="classMyNeighborResponse.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborResponse</a> *rrpc = <span class="keyword">new</span> <a class="code" href="classMyNeighborResponse.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborResponse</a>();
        rrpc-&gt;<a class="code" href="classMyNeighborResponse.html#a67ca94fa63d581fdc0263359297999d7">setRespondingNode</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>);
        rrpc-&gt;<a class="code" href="classMyNeighborResponse.html#a994c2c601a01025e4705212c46fba39e">setPrevNeighbor</a>(<a class="code" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a>);
        rrpc-&gt;<a class="code" href="classMyNeighborResponse.html#af8d9827b0f0f39bbb99fe8a39e8eb375">setNextNeighbor</a>(<a class="code" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a>);

        <span class="comment">// now send the response. sendRpcResponse can automatically tell where</span>
        <span class="comment">// to send it to. Note that sendRpcResponse will delete mrpc (aka msg)!</span>
        <a class="code" href="classBaseRpc.html#adc06091d348c98a5efbf54fe0afe8747" title="Send Remote-Procedure response message and deletes call message.">sendRpcResponse</a>(mrpc, rrpc);

        <a class="code" href="RpcMacros_8h.html#aa5e964b7c7129c0943237a786e455e9a">RPC_HANDLED</a> = <span class="keyword">true</span>;  <span class="comment">// set to true, since we did handle this RPC (default is false)</span>
    }

    <span class="comment">// end the switch</span>
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>();

    <span class="comment">// return whether we handled the message or not.</span>
    <span class="comment">// don&#39;t delete unhandled messages!</span>
    <span class="keywordflow">return</span> RPC_HANDLED;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ce676207ea25678af8eacc5d2b52902"></a><!-- doxytag: member="MyOverlay::handleRpcResponse" ref="a1ce676207ea25678af8eacc5d2b52902" args="(BaseResponseMessage *msg, cPolymorphic *context, int rpcId, simtime_t rtt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::handleRpcResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseResponseMessage.html">BaseResponseMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&nbsp;</td>
          <td class="paramname"> <em>rtt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00255">255</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// The macros are here similar. Just use RPC_ON_RESPONSE instead of RPC_ON_CALL.</span>

    <span class="comment">// start a switch</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg);

    <span class="comment">// enters the following block if the message is of type MyNeighborCall (note the shortened parameter!)</span>
    <a class="code" href="RpcMacros_8h.html#a0394d2dc4f9f1e15d7e99c9f43da10c7">RPC_ON_RESPONSE</a>(MyNeighbor) {
        <span class="comment">// get Response message</span>
        <a class="code" href="classMyNeighborResponse.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborResponse</a> *mrpc = (<a class="code" href="classMyNeighborResponse.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborResponse</a>*)msg;
        <span class="comment">// call our interface function</span>
        <a class="code" href="classMyOverlay.html#a55d11f3488949255da4a147bbd86b83e">callbackNeighbors</a>(mrpc-&gt;<a class="code" href="classMyNeighborResponse.html#af0fa0a0fcf034d6b1428632d07df14fa">getRespondingNode</a>(),
                          mrpc-&gt;<a class="code" href="classMyNeighborResponse.html#a940642558b27916a97048650e713143d">getPrevNeighbor</a>(),
                          mrpc-&gt;<a class="code" href="classMyNeighborResponse.html#ab620ae960038e7c5a7c986e8e416d38c">getNextNeighbor</a>());
    }
    <span class="comment">// end the switch</span>
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad0bd399bae0aa1631314d8904efe4038"></a><!-- doxytag: member="MyOverlay::handleRpcTimeout" ref="ad0bd399bae0aa1631314d8904efe4038" args="(BaseCallMessage *msg, const TransportAddress &amp;dest, cPolymorphic *context, int rpcId, const OverlayKey &amp;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::handleRpcTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBaseCallMessage.html">BaseCallMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classTransportAddress.html">TransportAddress</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cPolymorphic *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rpcId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00233">233</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// Same macros as in handleRpc</span>

    <span class="comment">// start a switch</span>
    <a class="code" href="RpcMacros_8h.html#aa75b135e279b574267e1a7dc4ab79da4" title="Marks the beginning of a Remote-Procedure-Call Switch block.">RPC_SWITCH_START</a>(msg);

    <span class="comment">// enters the following block if the message is of type MyNeighborCall (note the shortened parameter!)</span>
    <a class="code" href="RpcMacros_8h.html#ae07fad586ce7b9e82ad12848767a32e5">RPC_ON_CALL</a>(MyNeighbor) {
        <a class="code" href="classMyNeighborCall.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborCall</a> *mrpc = (<a class="code" href="classMyNeighborCall.html" title="Class generated from overlay/myoverlay/MyOverlay.msg by opp_msgc.">MyNeighborCall</a>*)msg;          <span class="comment">// get Call message</span>
        <a class="code" href="classMyOverlay.html#ab5282917369412abe224bbf606482284">callbackTimeout</a>(mrpc-&gt;<a class="code" href="classMyNeighborCall.html#a82546ebc4d1737ac38b56944c940bb70">getDestinationKey</a>());           <span class="comment">// call interface function</span>
    }
    <span class="comment">// end the switch</span>
    <a class="code" href="RpcMacros_8h.html#a29a8a3f21e67ecb25f58608a54df5191" title="Marks the end of a Remote-Procedure-Call Switch block.">RPC_SWITCH_END</a>();
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fa3f3705a1825911d534892d6846237"></a><!-- doxytag: member="MyOverlay::handleTimerEvent" ref="a9fa3f3705a1825911d534892d6846237" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::handleTimerEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00086">86</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (msg == <a class="code" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a>) {
        <span class="comment">// reschedule the timer</span>
        scheduleAt(simTime() + 5, <a class="code" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a>);

        <span class="comment">// if the simulator is still busy creating the network, let&#39;s wait a bit longer</span>
        <span class="keywordflow">if</span> (<a class="code" href="classBaseOverlay.html#af2f7102d7cc6f5ecb1c3ecb3d9c93df3" title="pointer to UnderlayConfigurator in this node">underlayConfigurator</a>-&gt;<a class="code" href="classUnderlayConfigurator.html#a00c2e85286a38799c7a04edb52ae6e76" title="still in initialization phase?">isInInitPhase</a>()) <span class="keywordflow">return</span>;

        <span class="comment">// pick either or next neighbor, or our previous neighbor, and request their neighbors</span>
        <a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a> key;
        <span class="keywordtype">int</span> neighborToAsk = intuniform(0, 1);

        <span class="keywordflow">if</span> (neighborToAsk == 0) key = <a class="code" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>();
        <span class="keywordflow">else</span> key = <a class="code" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>();

        <a class="code" href="classMyOverlay.html#ac42f8d1581e303ac02eb3d165c54df72">getNeighbors</a>(key);
    }
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a651f1dbe4f6371f3a58dff39ad457d48"></a><!-- doxytag: member="MyOverlay::initializeOverlay" ref="a651f1dbe4f6371f3a58dff39ad457d48" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::initializeOverlay </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes derived-class-attributes. </p>
<p><br/>
</p>
<p>Initializes derived-class-attributes, called by <a class="el" href="classBaseOverlay.html#a9738ba6065b0f699f1921bbe82ab97be" title="initializes base-class-attributes">BaseOverlay::initialize()</a>. By default this method is called once. If more stages are needed one can overload <a class="el" href="classBaseOverlay.html#a3234dfcf81463984e88a42432734a615" title="Sets init stage.">numInitStages()</a> and add more stages.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>stage</em>&nbsp;</td><td>the init stage </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a41f88dfbea856a2b38319ff52c758c96">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00041">41</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// see BaseApp.cc</span>
    <span class="keywordflow">if</span> (stage != <a class="code" href="InitStages_8h.html#a42fde1aa1e14a1c45d29061d6e87e532a58e83c497c7c8495e9c592ff3148b6b9" title="first stage for overlay modules (Tier 0 / KBR)">MIN_STAGE_OVERLAY</a>) <span class="keywordflow">return</span>;

    <span class="comment">// get our key from our IP address</span>
    <a class="code" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a> = <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a00e613d98d3412e2b92897c25aa0eb4c" title="returns ip address">getIp</a>().get4().getInt() &amp; ~BIGBIT;

    <span class="comment">// initialize the rest of variables</span>
    <a class="code" href="classMyOverlay.html#ac900d0d8bd93f7b17a6519d5ae1d8bc6" title="number of dropped packets">numDropped</a> = 0;
    <span class="keywordflow">if</span> (!(par(<span class="stringliteral">&quot;enableDrops&quot;</span>))) {
        <a class="code" href="classMyOverlay.html#a50231da7a7af9554661dafb98eb3ad61">dropChance</a> = 0;
    } <span class="keywordflow">else</span> {
        <a class="code" href="classMyOverlay.html#a50231da7a7af9554661dafb98eb3ad61">dropChance</a> = par(<span class="stringliteral">&quot;dropChance&quot;</span>);
    }

    <a class="code" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;RPC timer&quot;</span>);
    scheduleAt(simTime() + 5, <a class="code" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">rpcTimer</a>);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1a588f5af9c3aee2484d9d0e8ed89b44"></a><!-- doxytag: member="MyOverlay::isSiblingFor" ref="a1a588f5af9c3aee2484d9d0e8ed89b44" args="(const NodeHandle &amp;node, const OverlayKey &amp;key, int numSiblings, bool *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MyOverlay::isSiblingFor </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classNodeHandle.html">NodeHandle</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classOverlayKey.html">OverlayKey</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numSiblings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query if a node is among the siblings for a given key. </p>
<p>Query if a node is among the siblings for a given key. This means, that the nodeId of this node is among the closest numSiblings nodes to the key and that by a local <a class="el" href="classMyOverlay.html#a9bcbf789e463e45f5d8c2028e8568ca7" title="Implements the find node call.">findNode()</a> call all other siblings to this key can be retrieved.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>node</em>&nbsp;</td><td>the <a class="el" href="classNodeHandle.html" title="This class implements a node handle.">NodeHandle</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>key</em>&nbsp;</td><td>destination key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>numSiblings</em>&nbsp;</td><td>The nodes knows all numSiblings nodes close to this key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>err</em>&nbsp;</td><td>return false if the range could not be determined </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>bool true, if the node is responsible for the key. </dd></dl>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#ab5887b89ba9da5973068e834feb69ce7">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00107">107</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// is it our node and our key?</span>
    <span class="keywordflow">if</span> (node == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a> &amp;&amp; key == <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#aef531103cdf07c8353267f4d30a80112" title="returns key of this NodeHandle">getKey</a>()) {
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }
    <span class="comment">// we don&#39;t know otherwise</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a98f93274ec15fefc1bd3fa24af43b35c"></a><!-- doxytag: member="MyOverlay::joinOverlay" ref="a98f93274ec15fefc1bd3fa24af43b35c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::joinOverlay </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join the overlay with a given nodeID in thisNode.key. </p>
<p>Join the overlay with a given nodeID in thisNode.key. This method may be called by an application to join the overlay with a specific nodeID. It is also called if the node's IP address changes. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a3eefb56c2396601373c89d21b5b58110">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00070">70</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// Set the information of the previous step in the chain</span>
    <a class="code" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a>.<a class="code" href="classTransportAddress.html#a1c7b834dc2e6e738f1f4db8711a12814" title="Sets the ip address, port and NAT type.">setIp</a>(IPAddress(<a class="code" href="MyOverlay_8cc.html#a4b4493d6c307b977013a6585496ab2ab">BIGBIT</a> | (<a class="code" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a> - 1)));
    <a class="code" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a>.<a class="code" href="classTransportAddress.html#a46a1b53760e5f2d3f8af8c9591160a48" title="sets this-&amp;gt;port to the given port">setPort</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a4cf99c434c5110935683624dc3702e0f" title="returns port">getPort</a>());
    <a class="code" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">prevNode</a>.<a class="code" href="classNodeHandle.html#af3992f1fda9ea42dc10bf4739e47700a" title="saves given key to NodeHandle::key">setKey</a>(<a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a>(<a class="code" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a> - 1));

    <span class="comment">// Set the information of the next step in the chain</span>
    <a class="code" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a>.<a class="code" href="classTransportAddress.html#a1c7b834dc2e6e738f1f4db8711a12814" title="Sets the ip address, port and NAT type.">setIp</a>(IPAddress(<a class="code" href="MyOverlay_8cc.html#a4b4493d6c307b977013a6585496ab2ab">BIGBIT</a> | (<a class="code" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a> + 1)));
    <a class="code" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a>.<a class="code" href="classTransportAddress.html#a46a1b53760e5f2d3f8af8c9591160a48" title="sets this-&amp;gt;port to the given port">setPort</a>(<a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classTransportAddress.html#a4cf99c434c5110935683624dc3702e0f" title="returns port">getPort</a>());
    <a class="code" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">nextNode</a>.<a class="code" href="classNodeHandle.html#af3992f1fda9ea42dc10bf4739e47700a" title="saves given key to NodeHandle::key">setKey</a>(<a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a>(<a class="code" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a> + 1));

    <span class="comment">// tell the simulator that we&#39;re ready</span>
    <a class="code" href="classBaseOverlay.html#a9da615809e832cbc4645cc732d510277" title="Sets the overlay ready icon and register/deregisters the node at the GlobalNodeList.">setOverlayReady</a>(<span class="keyword">true</span>);
}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9d5aadf1daaa6e02cf3c785811278b0c"></a><!-- doxytag: member="MyOverlay::setOwnNodeID" ref="a9d5aadf1daaa6e02cf3c785811278b0c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MyOverlay::setOwnNodeID </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Overlay implementations can overwrite this virtual method to set a specific nodeID. </p>
<p>The default implementation sets a random nodeID. </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a31e60de81d77afdeb0e68f781ded0f9e">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8cc_source.html#l00062">62</a> of file <a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a>.</p>

<p><div class="fragment"><pre class="fragment">{
    <span class="comment">// create the corresponding overlay key</span>
    <a class="code" href="classBaseRpc.html#a88eb68c06450fd12ea072f471bf1c1b8" title="NodeHandle to this node.">thisNode</a>.<a class="code" href="classNodeHandle.html#af3992f1fda9ea42dc10bf4739e47700a" title="saves given key to NodeHandle::key">setKey</a>(<a class="code" href="classOverlayKey.html" title="A common overlay key class.">OverlayKey</a>(<a class="code" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">myKey</a>));
}
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a50231da7a7af9554661dafb98eb3ad61"></a><!-- doxytag: member="MyOverlay::dropChance" ref="a50231da7a7af9554661dafb98eb3ad61" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="classMyOverlay.html#a50231da7a7af9554661dafb98eb3ad61">MyOverlay::dropChance</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00040">40</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00121">findNode()</a>, and <a class="el" href="MyOverlay_8cc_source.html#l00041">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a2fa7ec8e7a3ddc53f12f713de777932f"></a><!-- doxytag: member="MyOverlay::myKey" ref="a2fa7ec8e7a3ddc53f12f713de777932f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classMyOverlay.html#a2fa7ec8e7a3ddc53f12f713de777932f">MyOverlay::myKey</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00035">35</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00041">initializeOverlay()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00070">joinOverlay()</a>, and <a class="el" href="MyOverlay_8cc_source.html#l00062">setOwnNodeID()</a>.</p>

</div>
</div>
<a class="anchor" id="af27533b75a26ab0f4a4eebb3f6680639"></a><!-- doxytag: member="MyOverlay::nextNode" ref="af27533b75a26ab0f4a4eebb3f6680639" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNodeHandle.html">NodeHandle</a> <a class="el" href="classMyOverlay.html#af27533b75a26ab0f4a4eebb3f6680639">MyOverlay::nextNode</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00037">37</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00121">findNode()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00197">handleRpcCall()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00086">handleTimerEvent()</a>, and <a class="el" href="MyOverlay_8cc_source.html#l00070">joinOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="ac900d0d8bd93f7b17a6519d5ae1d8bc6"></a><!-- doxytag: member="MyOverlay::numDropped" ref="ac900d0d8bd93f7b17a6519d5ae1d8bc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classMyOverlay.html#ac900d0d8bd93f7b17a6519d5ae1d8bc6">MyOverlay::numDropped</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>number of dropped packets </p>

<p>Reimplemented from <a class="el" href="classBaseOverlay.html#a4a82bd4b76a8d06a1d63bba98f1a34d7">BaseOverlay</a>.</p>

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00043">43</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00121">findNode()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00155">finishOverlay()</a>, and <a class="el" href="MyOverlay_8cc_source.html#l00041">initializeOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="a76ed822ecdba26c0f636cff3a9e402b7"></a><!-- doxytag: member="MyOverlay::prevNode" ref="a76ed822ecdba26c0f636cff3a9e402b7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classNodeHandle.html">NodeHandle</a> <a class="el" href="classMyOverlay.html#a76ed822ecdba26c0f636cff3a9e402b7">MyOverlay::prevNode</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00036">36</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00121">findNode()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00197">handleRpcCall()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00086">handleTimerEvent()</a>, and <a class="el" href="MyOverlay_8cc_source.html#l00070">joinOverlay()</a>.</p>

</div>
</div>
<a class="anchor" id="aebb5e36a760d5ad0b908d90da801b4f0"></a><!-- doxytag: member="MyOverlay::rpcTimer" ref="aebb5e36a760d5ad0b908d90da801b4f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="classMyOverlay.html#aebb5e36a760d5ad0b908d90da801b4f0">MyOverlay::rpcTimer</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MyOverlay_8h_source.html#l00032">32</a> of file <a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a>.</p>

<p>Referenced by <a class="el" href="MyOverlay_8cc_source.html#l00086">handleTimerEvent()</a>, <a class="el" href="MyOverlay_8cc_source.html#l00041">initializeOverlay()</a>, <a class="el" href="MyOverlay_8h_source.html#l00095">MyOverlay()</a>, and <a class="el" href="MyOverlay_8h_source.html#l00096">~MyOverlay()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="MyOverlay_8h_source.html">MyOverlay.h</a></li>
<li><a class="el" href="MyOverlay_8cc_source.html">MyOverlay.cc</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 3 2010 14:40:51 for OverSim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
